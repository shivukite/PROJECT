<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Insider Threat Detection • Behavioral Analytics Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121a33;
      --panel-2: #0f1630;
      --text: #e5ecff;
      --muted: #a6b1d4;
      --brand: #6aa8ff;
      --brand-2: #7effc5;
      --warn: #ffb86b;
      --danger: #ff6a77;
      --ok: #5cff9c;
      --glass: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.12);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.35), 0 2px 8px rgba(0,0,0,0.25);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1a2248 0%, #0b1020 50%, #070b18 100%);
      color: var(--text);
      overflow-x: hidden;
    }
    /* Animated gradient grid */
    .bg-grid::before {
      content: "";
      position: fixed; inset: 0; z-index: -2;
      background: linear-gradient(transparent 0, rgba(255,255,255,0.05) 2px, transparent 4px),
                  linear-gradient(90deg, transparent 0, rgba(255,255,255,0.05) 2px, transparent 4px);
      background-size: 40px 40px, 40px 40px;
      filter: blur(0.2px);
      mask: radial-gradient(1200px 800px at 30% -10%, rgba(0,0,0,0.7), transparent 60%);
      animation: gridScroll 20s linear infinite;
    }
    @keyframes gridScroll { to { transform: translateY(-40px); } }

    /* Navbar */
    header {
      position: sticky; top: 0; z-index: 30;
      background: linear-gradient(180deg, rgba(7,11,24,0.85), rgba(7,11,24,0.35));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .nav {
      max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 16px;
      padding: 14px 20px;
    }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 800; letter-spacing: 0.4px; }
    .brand .logo {
      width: 36px; height: 36px; border-radius: 12px; position: relative; overflow: hidden; box-shadow: var(--shadow);
      background: conic-gradient(from 0deg, var(--brand), var(--brand-2), var(--brand), var(--brand-2));
      animation: spin 6s linear infinite;
    }
    .brand .logo::after {
      content: ""; position: absolute; inset: 4px; border-radius: 10px; background: #0b1020; box-shadow: inset 0 0 20px rgba(122,255,197,0.2);
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .search {
      display: flex; align-items: center; gap: 8px; background: var(--glass); padding: 10px 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08);
    }
    .search input { background: transparent; border: none; outline: none; color: var(--text); width: 100%; font-size: 14px; }
    .actions { justify-self: end; display: flex; gap: 10px; align-items: center; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); color: var(--text); cursor: pointer; transition: 200ms ease;
    }
    .btn:hover { transform: translateY(-1px); border-color: rgba(255,255,255,0.16); }
    .pill { padding: 6px 10px; border-radius: 999px; font-size: 12px; background: rgba(106,168,255,0.15); border: 1px solid rgba(106,168,255,0.35); }

    /* Hero */
    .hero { max-width: 1200px; margin: 26px auto 10px; padding: 0 20px; display: grid; grid-template-columns: 2.2fr 1fr; gap: 20px; }
    .hero-card {
      position: relative; padding: 22px; border-radius: 18px; background: radial-gradient(200px 120px at 85% -40%, rgba(110,168,255,0.28), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03)); border: 1px solid rgba(255,255,255,0.08); box-shadow: var(--shadow);
      overflow: hidden;
    }
    .hero h1 { margin: 0 0 8px; font-size: 28px; letter-spacing: 0.3px; }
    .hero p { margin: 0; color: var(--muted); }
    .glow-orb { position: absolute; right: -30px; top: -30px; width: 160px; height: 160px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, var(--brand-2), rgba(126,255,197,0.1)); filter: blur(10px); opacity: 0.7; animation: float 6s ease-in-out infinite; }
    @keyframes float { 50% { transform: translateY(8px) translateX(-6px); opacity: 0.9; } }

    .stat-strip { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-top: 10px; }
    .kpi {
      padding: 16px; border-radius: 14px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08);
      display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 12px; position: relative; overflow: hidden;
    }
    .kpi::after { content: ""; position: absolute; inset: 0; background: radial-gradient(220px 120px at 110% -20%, rgba(106,168,255,0.2), transparent 60%); pointer-events: none; }
    .kpi .icon { width: 36px; height: 36px; border-radius: 10px; display: grid; place-items: center; background: rgba(106,168,255,0.2); box-shadow: inset 0 0 10px rgba(106,168,255,0.18);
      animation: pulse 2.2s ease-in-out infinite; }
    @keyframes pulse { 50% { transform: scale(1.04); } }
    .kpi h3 { margin: 0; font-size: 13px; color: var(--muted); font-weight: 500; }
    .kpi .value { font-size: 22px; font-weight: 800; letter-spacing: 0.3px; }
    .trend { font-size: 12px; }

    /* Main content grid */
    .grid { max-width: 1200px; margin: 10px auto 60px; padding: 0 20px; display: grid; grid-template-columns: 1.7fr 1.3fr; gap: 18px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 18px; padding: 18px; box-shadow: var(--shadow); }
    .card h2 { margin: 0 0 12px; font-size: 16px; font-weight: 700; letter-spacing: 0.3px; }

    /* Chart canvases */
    canvas { width: 100%; height: 280px; display: block; border-radius: 12px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); }

    /* Alerts table */
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 10px 8px; font-size: 13px; border-bottom: 1px dashed rgba(255,255,255,0.08); }
    th { color: var(--muted); font-weight: 600; }
    tr { transition: background 200ms ease; }
    tbody tr:hover { background: rgba(255,255,255,0.03); }
    .badge { font-size: 11px; padding: 6px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.05); }
    .b-danger { background: rgba(255,106,119,0.15); border-color: rgba(255,106,119,0.45); }
    .b-warn { background: rgba(255,184,107,0.15); border-color: rgba(255,184,107,0.45); }
    .b-ok { background: rgba(92,255,156,0.12); border-color: rgba(92,255,156,0.45); }

    /* Filters row */
    .filters { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; }
    .select, .input { background: var(--glass); border: 1px solid rgba(255,255,255,0.12); color: var(--text); padding: 10px 12px; border-radius: 12px; }
    select, input { background: transparent; border: none; outline: none; color: var(--text); font-size: 14px; }

    /* Timeline */
    .timeline { display: grid; gap: 16px; margin-top: 8px; }
    .event { display: grid; grid-template-columns: 28px 1fr; gap: 12px; align-items: start; }
    .dot { width: 12px; height: 12px; border-radius: 50%; background: var(--brand); box-shadow: 0 0 0 6px rgba(106,168,255,0.1), 0 0 16px rgba(106,168,255,0.55); animation: ping 2s infinite; }
    @keyframes ping { 50% { box-shadow: 0 0 0 12px rgba(106,168,255,0.06), 0 0 20px rgba(106,168,255,0.85); } }

    /* Toast */
    .toast { position: fixed; right: 20px; bottom: 20px; background: rgba(11,16,32,0.9); color: var(--text); border: 1px solid rgba(255,255,255,0.12); padding: 14px 16px; border-radius: 12px; box-shadow: var(--shadow); display: none; }

    /* Responsive */
    @media (max-width: 1000px) {
      .hero { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
      .stat-strip { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <header>
    <div class="nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div style="display:flex; align-items:center; gap:8px;">
            <span style="font-size:16px">Insider Threat</span>
            <span class="pill">Behavioral Analytics</span>
          </div>
          <small style="color:var(--muted)">Real‑time risk insights</small>
        </div>
      </div>
      <div class="search" role="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/></svg>
        <input id="search" placeholder="Search users, events, alerts… ( / )" aria-label="Search" />
      </div>
      <div class="actions">
        <button class="btn" id="connectBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 12h12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><path d="M3 12h.01M21 12h.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
          Connect
        </button>
        <button class="btn" id="themeBtn" aria-pressed="false" aria-label="Toggle theme">🌙</button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="hero-card" role="region" aria-label="Overview">
      <div class="glow-orb" aria-hidden="true"></div>
      <h1>Insider Threat Detection Dashboard</h1>
      <p>Monitor anomalous behavior, triage high‑risk users, and visualize alert trends in real time.</p>

      <div class="filters" style="margin-top:12px">
        <div class="select"><select id="dept">
          <option value="all">All Departments</option>
          <option>Engineering</option>
          <option>Finance</option>
          <option>HR</option>
          <option>Sales</option>
          <option>IT</option>
        </select></div>
        <div class="select"><select id="severity">
          <option value="all">All Severities</option>
          <option value="high">High</option>
          <option value="medium">Medium</option>
          <option value="low">Low</option>
        </select></div>
        <div class="input"><input type="date" id="fromDate"></div>
        <div class="input"><input type="date" id="toDate"></div>
        <button class="btn" id="applyFilters">Apply Filters</button>
        <span class="pill" id="clock"></span>
      </div>

      <div class="stat-strip" aria-live="polite">
        <div class="kpi" id="kpi-users">
          <div class="icon">👥</div>
          <div>
            <h3>Active Users</h3>
            <div class="value" data-target="4872">0</div>
            <div class="trend"><span class="badge b-ok">+2.3% today</span></div>
          </div>
        </div>
        <div class="kpi" id="kpi-highrisk">
          <div class="icon">⚠️</div>
          <div>
            <h3>High‑Risk Alerts</h3>
            <div class="value" data-target="38">0</div>
            <div class="trend"><span class="badge b-danger">+5 new</span></div>
          </div>
        </div>
        <div class="kpi" id="kpi-logins">
          <div class="icon">🔑</div>
          <div>
            <h3>Unusual Logins</h3>
            <div class="value" data-target="124">0</div>
            <div class="trend"><span class="badge b-warn">+12% vs avg</span></div>
          </div>
        </div>
        <div class="kpi" id="kpi-exfil">
          <div class="icon">🧲</div>
          <div>
            <h3>Data Exfil Attempts</h3>
            <div class="value" data-target="9">0</div>
            <div class="trend"><span class="badge b-danger">2 blocked</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="hero-card" role="region" aria-label="Risk Composition">
      <h2 style="margin:0 0 8px">Risk Composition</h2>
      <svg viewBox="0 0 120 120" width="100%" height="200" id="donut" aria-label="Risk composition donut" role="img"></svg>
      <div class="filters">
        <span class="badge">Exfiltration</span>
        <span class="badge">Privilege Misuse</span>
        <span class="badge">Anomalous Login</span>
        <span class="badge">Policy Violation</span>
      </div>
    </div>
  </section>

  <main class="grid">
    <section class="card" role="region" aria-label="Risk Score Over Time">
      <h2>Risk Score Over Time</h2>
      <canvas id="riskLine" width="900" height="320"></canvas>
    </section>

    <section class="card" role="region" aria-label="Alerts by Category">
      <h2>Alerts by Category</h2>
      <canvas id="barChart" width="900" height="320"></canvas>
      <div class="filters">
        <button class="btn" id="simulateBurst">Simulate Burst</button>
        <button class="btn" id="resetCharts">Reset</button>
      </div>
    </section>

    <section class="card" role="region" aria-label="Latest Alerts">
      <h2>Latest Alerts</h2>
      <table id="alertsTable">
        <thead>
          <tr>
            <th>Time</th>
            <th>User</th>
            <th>Department</th>
            <th>Category</th>
            <th>Severity</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="card" role="region" aria-label="Recent Activity">
      <h2>Recent Activity</h2>
      <div class="timeline" id="timeline"></div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="assertive"></div>

  <!-- Modal -->
  <dialog id="alertModal" style="border:none; border-radius:16px; padding:0; background:#0b1020; color:var(--text); width: min(680px, 95vw);">
    <div style="padding:18px; border-bottom:1px solid rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:space-between;">
      <strong>Alert Details</strong>
      <form method="dialog"><button class="btn">Close</button></form>
    </div>
    <div style="padding:18px; display:grid; gap:8px" id="alertDetails"></div>
  </dialog>

  <script>
    // --- Utility helpers ---
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const fmtTime = (d) => d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    const toast = (msg) => { const t=$('#toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=> t.style.display='none', 2200); };

    // --- Clock ---
    setInterval(()=> { $('#clock').textContent = new Date().toLocaleString(); }, 1000);

    // --- Theme toggle ---
    $('#themeBtn').addEventListener('click', (e)=>{
      const pressed = e.currentTarget.getAttribute('aria-pressed') === 'true';
      e.currentTarget.setAttribute('aria-pressed', String(!pressed));
      document.body.classList.toggle('light');
      toast(document.body.classList.contains('light') ? 'Light mode' : 'Dark mode');
    });

    // Light theme vars
    const lightVars = {
      '--bg': '#f6f7fb', '--panel':'#ffffff', '--panel-2':'#eef1ff', '--text':'#0f1735', '--muted':'#4c5680', '--glass':'rgba(0,0,0,0.04)', '--glass-2':'rgba(0,0,0,0.08)'
    };
    const applyThemeVars = (vars)=>{ for (const k in vars) document.documentElement.style.setProperty(k, vars[k]); };
    const observer = new MutationObserver(()=>{
      if (document.body.classList.contains('light')) applyThemeVars(lightVars); else location.reload(); // quick reset to dark base
    });
    observer.observe(document.body, { attributes:true, attributeFilter:['class']});

    // --- Animated KPI counters ---
    function animateCount(el){
      const target = Number(el.dataset.target||0); let cur = 0; const inc = Math.max(1, Math.floor(target/60));
      const step = ()=> { cur += inc; if (cur >= target) { el.textContent = target.toLocaleString(); return; } el.textContent = cur.toLocaleString(); requestAnimationFrame(step); };
      requestAnimationFrame(step);
    }
    $$('.kpi .value').forEach(animateCount);

    // --- Donut (SVG) ---
    function drawDonut(){
      const svg = $('#donut'); svg.innerHTML = '';
      const values = [rnd(15,35), rnd(10,30), rnd(20,40), rnd(5,20)];
      const total = values.reduce((a,b)=>a+b,0);
      let start = 0; const cx=60, cy=60, r=40, stroke=16;
      values.forEach((v,i)=>{
        const frac = v/total; const end = start + frac * Math.PI * 2;
        const x1 = cx + r * Math.cos(start), y1 = cy + r * Math.sin(start);
        const x2 = cx + r * Math.cos(end), y2 = cy + r * Math.sin(end);
        const large = frac > 0.5 ? 1 : 0;
        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d', `M ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2}`);
        path.setAttribute('fill','none');
        path.setAttribute('stroke', ['#6aa8ff','#7effc5','#ffb86b','#ff6a77'][i]);
        path.setAttribute('stroke-width', stroke);
        path.setAttribute('stroke-linecap','round');
        path.style.filter = 'drop-shadow(0 2px 8px rgba(0,0,0,0.3))';
        svg.appendChild(path);
        start = end;
      });
      // Center label
      const text = document.createElementNS('http://www.w3.org/2000/svg','text');
      text.textContent = 'Risk Mix'; text.setAttribute('x', cx); text.setAttribute('y', cy+5);
      text.setAttribute('text-anchor','middle'); text.setAttribute('font-size','12'); text.setAttribute('fill','currentColor'); svg.appendChild(text);
    }
    drawDonut();

    // --- Simple Canvas chart engine (animated) ---
    class SmoothLine {
      constructor(canvas){ this.c=canvas.getContext('2d'); this.w=canvas.width; this.h=canvas.height; this.data = Array.from({length:36}, ()=> rnd(20,80)); this.t=0; this.animate(); }
      draw(){ const {c,w,h,data} = this; c.clearRect(0,0,w,h);
        // grid
        c.globalAlpha=0.15; c.lineWidth=1; c.strokeStyle='#ffffff';
        for(let i=0;i<6;i++){ c.beginPath(); c.moveTo(0, (h/6)*i); c.lineTo(w, (h/6)*i); c.stroke(); }
        for(let i=0;i<12;i++){ c.beginPath(); c.moveTo((w/12)*i, 0); c.lineTo((w/12)*i, h); c.stroke(); }
        c.globalAlpha=1;
        // area gradient
        const grad = c.createLinearGradient(0,0,0,h);
        grad.addColorStop(0, 'rgba(106,168,255,0.6)'); grad.addColorStop(1, 'rgba(106,168,255,0.02)');
        // line
        c.beginPath();
        const dx = w/(data.length-1);
        data.forEach((v,i)=>{ const x=i*dx; const y=h - (v/100)*h; i?c.lineTo(x,y):c.moveTo(x,y); });
        c.strokeStyle = '#6aa8ff'; c.lineWidth=2.2; c.shadowBlur=14; c.shadowColor='rgba(106,168,255,0.6)'; c.stroke();
        // area fill
        c.lineTo(w,h); c.lineTo(0,h); c.closePath(); c.fillStyle=grad; c.fill(); c.shadowBlur=0;
      }
      tick(){ this.data.push(Math.min(100, Math.max(0, this.data.at(-1) + rnd(-8,8)))); this.data.shift(); }
      animate(){ this.draw(); this.t++; if (this.t%30===0) this.tick(); requestAnimationFrame(()=>this.animate()); }
    }

    class SmoothBars {
      constructor(canvas){ this.c=canvas.getContext('2d'); this.w=canvas.width; this.h=canvas.height;
        this.labels=['Exfil','Priv Misuse','Anom Login','Policy','USB'];
        this.values=[12,7,19,8,5]; this.target=[...this.values]; this.ani=0; this.draw(); }
      set(values){ this.target=values; this.ani=0; this.animateStep(); }
      animateStep(){ const step=()=>{ let done=true; for(let i=0;i<this.values.length;i++){ const cur=this.values[i], tar=this.target[i]; const d=(tar-cur)*0.15; this.values[i]=cur+ (Math.abs(d)<0.2? (done&=true, tar-cur): (done&=false, d)); }
        this.draw(); if(!done){ requestAnimationFrame(step); } }; requestAnimationFrame(step); }
      draw(){ const {c,w,h,labels,values}=this; c.clearRect(0,0,w,h);
        const max = Math.max(...values, 1); const bw = (w-80)/labels.length; c.font='12px Inter';
        // grid
        c.globalAlpha=0.15; c.strokeStyle='#ffffff'; c.lineWidth=1; for(let i=0;i<5;i++){ c.beginPath(); c.moveTo(60, (h/5)*i); c.lineTo(w-10, (h/5)*i); c.stroke(); } c.globalAlpha=1;
        // bars
        labels.forEach((lab,i)=>{ const val = values[i]; const x=60+i*bw; const barH = (val/max)*(h-40); const y=h-20-barH;
          const grad = c.createLinearGradient(0,y,0,y+barH); grad.addColorStop(0,'rgba(126,255,197,0.8)'); grad.addColorStop(1,'rgba(126,255,197,0.1)');
          c.fillStyle = grad; c.strokeStyle='rgba(126,255,197,0.9)'; c.lineWidth=1.5; c.beginPath(); c.roundRect(x+6,y,bw-16,barH,8); c.fill(); c.stroke();
          c.fillStyle='currentColor'; c.fillText(lab, x+8, h-6); c.fillText(Math.round(val), x+8, y-6);
        });
      }
    }

    // Polyfill for roundRect on some browsers
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r){
        const ctx=this; if (w<2*r) r=w/2; if (h<2*r) r=h/2; ctx.beginPath(); ctx.moveTo(x+r, y); ctx.arcTo(x+w, y, x+w, y+h, r); ctx.arcTo(x+w, y+h, x, y+h, r); ctx.arcTo(x, y+h, x, y, r); ctx.arcTo(x, y, x+w, y, r); ctx.closePath(); return ctx; };
    }

    const riskChart = new SmoothLine($('#riskLine'));
    const barChart = new SmoothBars($('#barChart'));

    // --- Simulated stream ---
    let connected=false, streamInt=null; $('#connectBtn').addEventListener('click', ()=>{
      connected=!connected; $('#connectBtn').innerHTML = connected ? '🔌 Connected' : 'Connect';
      if (connected) {
        toast('Streaming simulated events…');
        streamInt = setInterval(()=>{
          // Update KPIs
          const high = $('#kpi-highrisk .value'); high.dataset.target = Number(high.dataset.target)+rnd(0,2); animateCount(high);
          const log = $('#kpi-logins .value'); log.dataset.target = Number(log.dataset.target)+rnd(-2,3); animateCount(log);
          const exf = $('#kpi-exfil .value'); exf.dataset.target = Math.max(0, Number(exf.dataset.target)+rnd(-1,2)); animateCount(exf);
          // Table event
          pushAlert();
          // Bars random jitter
          const vals = barChart.values.map(v => Math.max(0, v + rnd(-2,3)));
          barChart.set(vals);
        }, 2000);
      } else { clearInterval(streamInt); toast('Disconnected'); }
    });

    $('#simulateBurst').addEventListener('click', ()=>{
      const vals = barChart.values.map((v,i)=> i===0? v + rnd(8,16) : v + rnd(3,9));
      barChart.set(vals); toast('Burst detected in Exfiltration');
    });
    $('#resetCharts').addEventListener('click', ()=>{ barChart.set([12,7,19,8,5]); toast('Charts reset'); });

    // --- Alerts table with modal ---
    const users = ['ajoshi','rkumar','smehta','jdoe','kpatel','lwang','mkhan','ssingh','nrao','tng'];
    const deps = ['Engineering','Finance','HR','Sales','IT'];
    const cats = ['Exfiltration','Privilege Misuse','Anomalous Login','Policy Violation','USB Activity'];

    function pushAlert(){
      const tbody = $('#alertsTable tbody');
      const now = new Date();
      const user = users[rnd(0, users.length-1)];
      const dep = deps[rnd(0, deps.length-1)];
      const cat = cats[rnd(0, cats.length-1)];
      const sevIdx = rnd(0,2); const sev = ['Low','Medium','High'][sevIdx];
      const tr = document.createElement('tr'); tr.style.opacity=0; tr.style.transform='translateY(-6px)';
      tr.innerHTML = `<td>${fmtTime(now)}</td><td>${user}</td><td>${dep}</td><td>${cat}</td>
        <td><span class="badge ${sev==='High'?'b-danger':sev==='Medium'?'b-warn':'b-ok'}">${sev}</span></td>
        <td><button class="btn btn-sm">View</button></td>`;
      tbody.prepend(tr);
      requestAnimationFrame(()=>{ tr.style.transition='400ms ease'; tr.style.opacity=1; tr.style.transform='none'; });
      tr.querySelector('button').addEventListener('click', ()=> openAlertModal({time: now, user, dep, cat, sev}));

      // Keep last 12
      while (tbody.children.length > 12) tbody.lastElementChild.remove();

      // timeline ping
      addTimeline(`${user} • ${cat} • ${sev}`);
    }

    function addTimeline(text){
      const t = $('#timeline');
      const div = document.createElement('div'); div.className='event';
      div.innerHTML = `<div class="dot"></div><div><strong>${fmtTime(new Date())}</strong><div style="color:var(--muted)">${text}</div></div>`;
      t.prepend(div);
      while (t.children.length > 8) t.lastElementChild.remove();
    }

    function openAlertModal({time, user, dep, cat, sev}){
      const modal = $('#alertModal');
      $('#alertDetails').innerHTML = `
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div><div class="muted">Time</div><div><strong>${time.toLocaleString()}</strong></div></div>
          <div><div class="muted">User</div><div><strong>@${user}</strong></div></div>
          <div><div class="muted">Department</div><div><strong>${dep}</strong></div></div>
          <div><div class="muted">Category</div><div><strong>${cat}</strong></div></div>
          <div><div class="muted">Severity</div><div><span class="badge ${sev==='High'?'b-danger':sev==='Medium'?'b-warn':'b-ok'}">${sev}</span></div></div>
          <div><div class="muted">Confidence</div><div><strong>${rnd(65,98)}%</strong></div></div>
        </div>
        <div style="margin-top:10px; padding:12px; border-radius:12px; background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08)">
          <strong>Suggested Actions</strong>
          <ul>
            <li>Isolate endpoint and rotate credentials</li>
            <li>Open investigation ticket with evidence bundle</li>
            <li>Notify SOC channel and line manager</li>
          </ul>
        </div>`;
      modal.showModal();
    }

    // Seed initial rows
    for (let i=0;i<6;i++) pushAlert();

    // --- Filters (client-side demo only) ---
    $('#applyFilters').addEventListener('click', ()=>{
      const d = $('#dept').value, s=$('#severity').value;
      $$('#alertsTable tbody tr').forEach(tr=>{
        const dep = tr.children[2].textContent.trim();
        const sev = tr.children[4].innerText.trim().toLowerCase();
        const depOk = (d==='all' || dep===d); const sevOk = (s==='all' || sev.includes(s));
        tr.style.display = (depOk && sevOk) ? '' : 'none';
      });
    });

    // --- Keyboard shortcuts ---
    window.addEventListener('keydown', (e)=>{
      if (e.key === '/') { e.preventDefault(); $('#search').focus(); }
      if (e.key.toLowerCase() === 'c' && e.ctrlKey) { $('#connectBtn').click(); }
    });

    // Accessibility polish
    $$('.muted').forEach(el=> el.style.color='var(--muted)');
  </script>
</body>
</html>
